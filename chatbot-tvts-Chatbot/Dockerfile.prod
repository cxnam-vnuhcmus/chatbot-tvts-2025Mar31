FROM python:3.10.13

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV MODEL=${MODEL}
ENV SETTING_CHATBOT_VERSION=${MODEL}
ENV DB_HOST=${DB_HOST}
ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_PORT=${DB_PORT}
ENV CHROMA_HOST=${CHROMA_HOST}
ENV CHROMA_PORT=${CHROMA_PORT}
ENV EMBEDDING_MODEL_NAME=${EMBEDDING_MODEL_NAME}
ENV CHROMA_DB=${EMBEDDING_MODEL_NAME}_markdown_docs
ENV DB_NAME=${EMBEDDING_MODEL_NAME}_metadb
ENV DB_CHATNAME=${DB_CHATNAME}
ENV CHATBOT_AGENT_PORT=${CHATBOT_AGENT_PORT}
ENV API_URL==${API_URL}

COPY ./requirements.txt .

RUN pip install -r requirements.txt
RUN pip install gunicorn

COPY . .

EXPOSE 6811
EXPOSE 8000

RUN chmod +x entrypoint.sh

CMD ["entrypoint.sh"]